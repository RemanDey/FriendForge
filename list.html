<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends List - FriendForge</title>
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Universal Box Sizing */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* General Body Styling - Modern Dark Mode */
        body {
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; /* Modern, clean font stack */
            background-color: #121212; /* Deeper, more sophisticated dark background */
            color: #E0E0E0; /* Soft white for primary text */
            margin: 0;
            padding: 20px 15px; /* More responsive padding for smaller screens */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
            line-height: 1.6;
            text-rendering: optimizeLegibility; /* Improve text rendering */
        }

        /* Container for the entire app - Modern Dark Mode */
        .container {
            width: 100%; /* Default to full width minus padding */
            max-width: 960px; /* Limit max width for large screens */
            background-color: #1F1F1F; /* Darker charcoal for container */
            border-radius: 15px; /* More rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); /* More pronounced, softer shadow */
            padding: 25px 20px; /* Adjusted padding for responsiveness */
            box-sizing: border-box;
            margin-bottom: 30px;
            border: 1px solid rgba(60, 60, 60, 0.8); /* Subtle border for definition */
            transition: all 0.3s ease-in-out; /* Smooth transition for hover effects */
        }

        .container:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7); /* Deeper shadow on hover */
            transform: translateY(-3px); /* Slight lift on hover */
        }

        /* Navigation Styling - Modern Dark Mode */
        nav {
            display: flex;
            flex-direction: column; /* Stack navigation links in portrait by default */
            justify-content: center;
            gap: 15px; /* Adjust gap for stacking */
            margin-bottom: 30px; /* More separation from content */
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(70, 70, 70, 0.6);
        }

        nav a {
            text-decoration: none;
            color: #81D4FA;
            padding: 10px 20px; /* Smaller padding for stacked links */
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
            font-weight: 600;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center; /* Center text and icon in stacked mode */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            white-space: nowrap; /* Prevent text wrapping */
        }

        nav a i {
            margin-right: 8px; /* Slightly less space for icons */
            font-size: 1.1em;
        }

        nav a:hover {
            background-color: #00838F;
            color: #FFFFFF;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        nav a.active {
            background-color: #00ACC1;
            color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        /* Main Heading - Modern Dark Mode */
        .main-title-link {
            text-decoration: none;
            color: inherit;
            display: block;
            text-align: center;
        }

        h1 {
            text-align: center;
            color: #B3E5FC;
            margin-bottom: 25px; /* Reduced margin */
            font-size: 2.5em; /* Slightly smaller for mobile first */
            font-weight: 700;
            letter-spacing: 0.05em;
            text-shadow: 0 2px 8px rgba(0, 172, 193, 0.4);
            border-bottom: 2px solid #00ACC1;
            padding-bottom: 15px; /* Reduced padding */
            transition: all 0.3s ease-in-out;
        }

        h1:hover {
            color: #E0F7FA;
            text-shadow: 0 3px 12px rgba(0, 172, 193, 0.7);
            transform: translateY(-2px);
        }

        /* Section Headings - Modern Dark Mode */
        .input-section h2, .display-section h2 {
            color: #81D4FA;
            margin-top: 0;
            margin-bottom: 20px; /* Reduced margin */
            border-bottom: 1px solid #00838F;
            padding-bottom: 10px; /* Reduced padding */
            font-size: 1.8em; /* Adjusted for smaller screens */
            font-weight: 600;
            text-align: center;
        }

        /* Form Styling (copied from index.html for consistency, though not directly used here) */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Reduced gap */
            padding: 20px; /* Reduced padding */
            border: 1px solid rgba(0, 172, 193, 0.4);
            border-radius: 12px;
            background-color: #282828;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4); /* Reduced shadow */
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px; /* Reduced margin */
            font-weight: bold;
            color: #B3E5FC;
            font-size: 1em; /* Adjusted font size */
        }

        .form-group input[type="text"],
        .form-group textarea {
            padding: 10px 12px; /* Reduced padding */
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 1em; /* Adjusted font size */
            background-color: #333;
            color: #E0E0E0;
            resize: vertical;
            min-height: 45px; /* Adjusted min height */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.4); /* Reduced shadow */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #00ACC1;
            box-shadow: 0 0 0 3px rgba(0, 172, 193, 0.3), inset 0 1px 2px rgba(0, 0, 0, 0.6);
        }

        /* Styling for range inputs (sliders) */
        .form-group input[type="range"] {
            -webkit-appearance: none; /* Remove default styling */
            width: 100%;
            height: 10px; /* Adjust height of the track */
            background: #444; /* Default track color */
            border-radius: 5px;
            outline: none;
            margin: 10px 0; /* Space above/below */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.4);
            transition: background 0.3s ease;
        }

        /* Thumb (handle) styling for Webkit browsers (Chrome, Safari) */
        .form-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px; /* Size of the thumb */
            height: 25px; /* Size of the thumb */
            border-radius: 50%; /* Make it circular */
            background: #00ACC1; /* Thumb color */
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            margin-top: -8px; /* Center thumb vertically on track */
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        /* Thumb (handle) styling for Firefox */
        .form-group input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #00ACC1;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            border: none; /* Remove default border */
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        /* Focus styles for the slider thumb */
        .form-group input[type="range"]:focus::-webkit-slider-thumb {
            box-shadow: 0 0 0 4px rgba(0, 172, 193, 0.4), 0 2px 8px rgba(0, 0, 0, 0.6);
            transform: scale(1.1);
        }
        .form-group input[type="range"]:focus::-moz-range-thumb {
            box-shadow: 0 0 0 4px rgba(0, 172, 193, 0.4), 0 2px 8px rgba(0, 0, 0, 0.6);
            transform: scale(1.1);
        }

        /* Container for slider and its value */
        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px; /* Space between slider and value display */
        }

        .slider-group input[type="range"] {
            flex-grow: 1; /* Make slider take up available space */
            margin: 0; /* Reset margin from general range styling */
        }

        .slider-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #B3E5FC;
            min-width: 30px; /* Ensure space for two digits + /10 */
            text-align: right;
        }

        /* Button Styling - Modern Dynamic */
        button {
            padding: 10px 20px; /* Reduced padding */
            background-color: #00ACC1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.05em; /* Adjusted font size */
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 172, 193, 0.4); /* Reduced shadow */
        }

        button:hover {
            background-color: #00838F;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 172, 193, 0.3);
        }

        #clearForm { /* This button is on index.html, keeping for consistency */
            background-color: #FFB300;
            box-shadow: 0 3px 10px rgba(255, 179, 0, 0.4);
        }
        #clearForm:hover {
            background-color: #FB8C00;
            box-shadow: 0 5px 15px rgba(255, 179, 0, 0.6);
        }

        .delete-button {
            background-color: #E53935;
            margin-top: 20px; /* Reduced margin */
            box-shadow: 0 3px 10px rgba(229, 57, 53, 0.4);
        }
        .delete-button:hover {
            background-color: #C62828;
            box-shadow: 0 5px 15px rgba(229, 57, 53, 0.6);
        }

        /* Friend Cards Display Grid (Mobile-first adjustment) */
        .friends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); /* Safer min-width for portrait phones */
            gap: 20px; /* Reduced gap */
        }

        /* Styling for individual friend cards (Adjusted for responsiveness) */
        .friend-card {
            background-color: #282828;
            border: 1px solid rgba(70, 70, 70, 0.8);
            border-radius: 10px; /* Slightly less rounded */
            padding: 18px 20px; /* Adjusted padding */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* Reduced shadow */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            position: relative;
            color: #E0E0E0;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .friend-card:hover {
            transform: translateY(-4px); /* Slightly less pronounced lift */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6); /* Adjusted shadow */
            border-color: #00ACC1;
        }

        /* Friend Name Styling */
        .friend-card h3 {
            color: #B3E5FC;
            margin-top: 0;
            margin-bottom: 12px; /* Reduced margin */
            border-bottom: 1px solid #00838F;
            padding-bottom: 8px; /* Reduced padding */
            font-size: 1.6em; /* Adjusted font size */
            font-weight: 600;
            pointer-events: none;
        }

        /* Parameter Text Styling */
        .friend-card p {
            color: #C0C0C0;
            margin: 5px 0; /* Reduced margin */
            line-height: 1.4;
            font-size: 0.9em; /* Slightly smaller font size */
            pointer-events: none;
        }

        /* Parameter Name (e.g., "Truthfulness:") Styling */
        .friend-card strong {
            color: #81D4FA;
            min-width: 100px; /* Adjusted for smaller screens */
            display: inline-block;
        }

        .friend-card .delete-card-button {
            position: absolute;
            top: 10px; /* Adjusted position */
            right: 10px; /* Adjusted position */
            background-color: #E53935;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px; /* Smaller button */
            height: 32px; /* Smaller button */
            font-size: 1.1em; /* Adjusted font size */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            padding: 0;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            z-index: 10;
        }

        .friend-card .delete-card-button:hover {
            background-color: #C62828;
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
        }

        /* --- Progress Bar Styles - Modern Dynamic --- */
        .progress-container {
            width: 100%;
            background-color: #3A3A3A;
            border-radius: 8px;
            overflow: hidden;
            height: 10px; /* Slightly thinner bars */
            margin-top: 6px; /* Reduced margin */
            margin-bottom: 10px; /* Reduced margin */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            border-radius: 8px;
            transition: width 0.8s ease-out, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 5px;
            font-size: 0.7em;
            color: rgba(255,255,255,0.8);
        }

        /* Dynamic Colors for Progress Bars */
        .progress-bar.low { background-color: #FF5252; }
        .progress-bar.medium { background-color: #FFD740; }
        .progress-bar.high { background-color: #69F0AE; }


        /* Specific styling for the text-based parameters to ensure consistent spacing */
        .friend-card p.text-param {
            margin-top: 12px;
            margin-bottom: 6px;
            color: #B0B0B0;
        }

        /* Search Bar Styling - Modern Dark Mode */
        .search-container {
            margin-bottom: 25px;
            text-align: center;
        }

        #searchBar {
            padding: 10px 15px;
            width: 90%;
            max-width: 400px;
            border: 1px solid #444;
            border-radius: 20px;
            font-size: 1em;
            background-color: #333;
            color: #E0E0E0;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #searchBar::placeholder {
            color: #999;
        }

        #searchBar:focus {
            outline: none;
            border-color: #00ACC1;
            box-shadow: 0 0 0 3px rgba(0, 172, 193, 0.3), inset 0 1px 3px rgba(0,0,0,0.6);
        }

        /* Export/Import Buttons Container */
        .data-management-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
            margin-bottom: 30px;
            padding-top: 15px;
            border-top: 1px solid rgba(70, 70, 70, 0.6);
        }

        .data-management-buttons button {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .data-management-buttons button i {
            margin-right: 8px;
        }

        #exportData {
            background-color: #4CAF50; /* Green for export */
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.4);
        }
        #exportData:hover {
            background-color: #45a049;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.6);
        }

        #importDataButton {
            background-color: #2196F3; /* Blue for import */
            box-shadow: 0 3px 10px rgba(33, 150, 243, 0.4);
        }
        #importDataButton:hover {
            background-color: #1e88e5;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.6);
        }

        /* Hide the actual file input */
        #importFileInput {
            display: none;
        }

        /* --- Filter Controls Styles --- */
        .filter-controls-container {
            position: relative;
            display: flex;
            flex-direction: column; /* Stack button and panel on small screens */
            align-items: center; /* Center the button */
            margin-bottom: 25px;
            z-index: 90;
        }

        #filterButton {
            padding: 10px 20px;
            background-color: #00897B; /* Teal color for filter */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 137, 123, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #filterButton i {
            margin-right: 8px;
        }
        #filterButton:hover {
            background-color: #00695C;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 137, 123, 0.6);
        }

        .filter-dropdown-menu {
            position: absolute;
            top: calc(100% + 10px);
            background-color: #2F2F2F;
            border: 1px solid rgba(100, 100, 100, 0.8);
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            min-width: 280px; /* Wider to accommodate inputs */
            max-width: 90%; /* Max width for responsiveness */
            display: none; /* Hidden by default */
            flex-direction: column;
            padding: 15px;
            animation: fadeInScale 0.2s ease-out forwards;
            transform-origin: top center;
        }

        .filter-dropdown-menu.visible {
            display: flex;
        }

        .filter-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed rgba(100, 100, 100, 0.5);
        }
        .filter-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .filter-section h4 {
            color: #B2DFDB;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1em;
            text-align: center;
        }

        .filter-param-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        .filter-param-group label {
            flex-basis: 100px; /* Fixed width for labels */
            color: #E0E0E0;
            font-size: 0.95em;
        }
        .filter-param-group input[type="number"],
        .filter-param-group input[type="text"] {
            flex-grow: 1; /* Allow inputs to take remaining space */
            padding: 8px 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #333;
            color: #E0E0E0;
            font-size: 0.9em;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .filter-param-group input[type="number"]:focus,
        .filter-param-group input[type="text"]:focus {
            outline: none;
            border-color: #00897B;
            box-shadow: 0 0 0 3px rgba(0, 137, 123, 0.3), inset 0 1px 2px rgba(0,0,0,0.5);
        }
        .filter-param-group input[type="number"]::placeholder,
        .filter-param-group input[type="text"]::placeholder {
            color: #999;
        }

        .filter-actions {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 10px;
        }
        .filter-action-btn {
            flex-grow: 1;
            padding: 10px 15px;
            font-size: 0.95em;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .filter-action-btn.clear-btn {
            background-color: #616161; /* Grey for clear button */
            box-shadow: 0 3px 10px rgba(97, 97, 97, 0.4);
        }
        .filter-action-btn.clear-btn:hover {
            background-color: #424242;
            box-shadow: 0 5px 15px rgba(97, 97, 97, 0.6);
        }
        /* Reusing general button styling for apply button */
        #applyFiltersBtn {
            background-color: #00ACC1; /* Blue from general button style */
            box-shadow: 0 3px 10px rgba(0, 172, 193, 0.4);
        }
        #applyFiltersBtn:hover {
            background-color: #00838F;
            box-shadow: 0 5px 15px rgba(0, 172, 193, 0.6);
        }

        /* Optional: Animation for dropdown */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-5px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* --- Sorting Controls Styles --- */
        .sort-controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .sort-controls-container label {
            font-weight: bold;
            color: #B2DFDB;
            font-size: 1em;
        }

        #sortSelect {
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 0.95em;
            background-color: #333;
            color: #E0E0E0;
            appearance: none; /* Remove default dropdown arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23E0E0E0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>'); /* Custom arrow */
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 20px;
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            min-width: 180px; /* Ensure enough width for options */
        }

        #sortSelect:focus {
            outline: none;
            border-color: #00ACC1;
            box-shadow: 0 0 0 3px rgba(0, 172, 193, 0.3), inset 0 1px 3px rgba(0,0,0,0.6);
        }

        /* --- Friend Comparison Styles --- */
        .comparison-controls-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(70, 70, 70, 0.6);
        }

        .comparison-dropdowns {
            display: flex;
            flex-direction: column; /* Stack dropdowns on small screens */
            gap: 10px;
            width: 100%;
            max-width: 500px;
        }
        .comparison-dropdowns select {
            padding: 10px 15px;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 1em;
            background-color: #333;
            color: #E0E0E0;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23E0E0E0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 24px;
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            flex-grow: 1; /* Allow dropdowns to grow */
        }
        .comparison-dropdowns select:focus {
            outline: none;
            border-color: #00ACC1;
            box-shadow: 0 0 0 3px rgba(0, 172, 193, 0.3), inset 0 1px 3px rgba(0,0,0,0.6);
        }

        #compareFriendsBtn {
            width: 100%; /* Full width button on small screens */
            max-width: 250px; /* Limit button width */
            background-color: #673AB7; /* Deep Purple for compare */
            box-shadow: 0 3px 10px rgba(103, 58, 183, 0.4);
        }
        #compareFriendsBtn:hover {
            background-color: #512DA8;
            box-shadow: 0 5px 15px rgba(103, 58, 183, 0.6);
        }

        #comparisonResult {
            margin-top: 20px;
            background-color: #282828;
            border: 1px solid rgba(70, 70, 70, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            display: none; /* Hidden by default, shown by JS */
            flex-direction: column;
            gap: 15px;
        }

        #comparisonResult h3 {
            color: #BBDEFB;
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 1px solid #424242;
            padding-bottom: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th, .comparison-table td {
            padding: 10px 15px;
            text-align: left;
            border-bottom: 1px solid #3A3A3A;
        }

        .comparison-table th {
            background-color: #3A3A3A;
            color: #BBDEFB;
            font-weight: 600;
            font-size: 1.1em;
            vertical-align: top; /* Align headers to top */
        }

        .comparison-table td {
            color: #E0E0E0;
            font-size: 1em;
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .comparison-table .param-label {
            width: 30%; /* Adjust width for labels */
            font-weight: bold;
            color: #81D4FA;
            white-space: nowrap; /* Prevent wrapping */
        }
        .comparison-table .friend-value-column {
             width: 35%; /* Equal width for friend values */
             vertical-align: middle;
        }
        /* Specific styling for the text-based parameters in comparison */
        .comparison-table td.text-param-value {
            white-space: normal; /* Allow text to wrap naturally */
            word-wrap: break-word; /* Break long words */
            max-width: 250px; /* Limit max width of text column if needed */
        }

        /* --- Media Queries for Landscape / Larger Screens --- */

        /* For screens wider than 576px (e.g., larger phones in landscape, small tablets) */
        @media (min-width: 576px) {
            .container {
                padding: 30px 30px; /* More generous padding */
            }

            nav {
                flex-direction: row; /* Navigation links appear side-by-side */
                gap: 20px; /* More space between links */
            }

            nav a {
                padding: 10px 22px; /* Slightly larger clickable area */
                font-size: 1.05em;
            }

            h1 {
                font-size: 2.8em; /* Slightly larger heading */
                margin-bottom: 30px;
                padding-bottom: 18px;
            }

            .input-section h2, .display-section h2 {
                font-size: 2em; /* Larger section headings */
                margin-bottom: 22px;
                padding-bottom: 12px;
            }

            .friends-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Allow two columns more easily */
                gap: 22px;
            }
            .friend-card {
                padding: 20px 22px;
            }

            .data-management-buttons {
                flex-direction: row; /* Buttons side-by-side */
                justify-content: center;
            }
            .data-management-buttons button {
                width: auto; /* Allow buttons to size content */
                min-width: 150px;
            }
            /* Filter controls adjustment */
            .filter-controls-container {
                flex-direction: row; /* Button and panel inline */
                justify-content: center;
            }
            .filter-dropdown-menu {
                left: auto; /* Revert left/right centering */
                right: auto;
                transform: translateX(-50%); /* Center horizontally relative to parent */
                left: 50%; /* Position at 50% for centering */
            }

            /* Comparison controls adjustment */
            .comparison-controls-container {
                flex-direction: row; /* Dropdowns and button inline */
                flex-wrap: wrap; /* Allow wrapping if not enough space */
                justify-content: center;
            }
            .comparison-dropdowns {
                flex-direction: row; /* Dropdowns side-by-side */
                max-width: none; /* Remove max-width */
                flex-grow: 1; /* Allow them to take space */
            }
            #compareFriendsBtn {
                width: auto; /* Button auto-width */
                min-width: 150px;
            }
            #comparisonResult h3 {
                font-size: 2em;
            }
            .comparison-table th, .comparison-table td {
                padding: 12px 18px; /* More padding */
            }
        }

        /* For screens wider than 768px (e.g., tablets in landscape, desktops) */
        @media (min-width: 768px) {
            body {
                padding: 40px 20px; /* Restore original body padding */
            }

            .container {
                padding: 35px 45px; /* Restore original container padding */
            }

            nav {
                gap: 25px; /* Restore original nav gap */
                margin-bottom: 40px;
                padding-bottom: 20px;
            }

            nav a {
                padding: 12px 25px; /* Restore original nav link padding */
                font-size: 1.1em;
                justify-content: center; /* Ensure centered still for better alignment */
            }

            h1 {
                font-size: 3em; /* Restore original heading size */
                margin-bottom: 35px;
                padding-bottom: 18px;
            }

            .input-section h2, .display-section h2 {
                font-size: 2.2em; /* Restore original section heading size */
                margin-bottom: 25px;
                padding-bottom: 12px;
            }

            form {
                gap: 20px; /* Restore original form gap */
                padding: 25px; /* Restore original form padding */
            }

            .form-group label {
                margin-bottom: 8px; /* Restore original label margin */
                font-size: 1.05em;
            }

            .form-group input[type="text"],
            .form-group textarea {
                padding: 12px 15px; /* Restore original input padding */
                font-size: 1.1em;
                min-height: 50px; /* Restore original min height */
            }

            button {
                padding: 12px 25px; /* Restore original button padding */
                font-size: 1.15em;
            }

            #clearForm {
                margin-top: 0; /* Align with save button */
            }

            .delete-button {
                margin-top: 25px; /* Restore original margin */
            }

            .friends-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* Restore original card min-width */
                gap: 25px; /* Restore original card gap */
            }

            .friend-card {
                border-radius: 12px; /* Restore original card border-radius */
                padding: 20px 25px; /* Restore original card padding */
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4); /* Restore original shadow */
            }

            .friend-card:hover {
                transform: translateY(-5px); /* Restore original lift */
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6); /* Restore original shadow */
            }

            .friend-card h3 {
                margin-bottom: 15px; /* Restore original margin */
                padding-bottom: 10px; /* Restore original padding */
                font-size: 1.8em; /* Restore original font size */
            }

            .friend-card p {
                margin: 6px 0; /* Restore original margin */
                font-size: 0.95em; /* Restore original font size */
            }

            .friend-card strong {
                min-width: 110px; /* Restore original min-width */
            }

            .friend-card .delete-card-button {
                width: 36px; /* Restore original button size */
                height: 36px; /* Restore original button size */
                font-size: 1.3em; /* Restore original font size */
                top: 15px; /* Restore original position */
                right: 15px; /* Restore original position */
            }

            .progress-container {
                height: 12px; /* Restore original bar height */
                margin-top: 8px; /* Restore original margin */
                margin-bottom: 15px; /* Restore original margin */
            }

            .friend-card p.text-param {
                margin-top: 15px; /* Restore original margin */
                margin-bottom: 8px; /* Restore original margin */
            }

            .search-container {
                margin-bottom: 30px; /* Restore original margin */
            }

            #searchBar {
                padding: 12px 20px; /* Restore original search bar padding */
                max-width: 450px; /* Restore original max-width */
                border-radius: 25px; /* Restore original border-radius */
                font-size: 1.1em; /* Restore original font size */
            }
        }

        /* Specific adjustment for navigation in very wide screens to prevent stretching */
        @media (min-width: 992px) {
            nav {
                max-width: 800px; /* Limit nav width for aesthetic */
                width: 100%;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <a href="about.html" class="main-title-link">
            <h1>FriendForge</h1>
        </a>

        <nav>
            <a href="index.html"><i class="fas fa-plus-circle"></i> Add Friend</a>
            <a href="list.html" class="active"><i class="fas fa-users"></i> View Friends List</a>
        </nav>

        <div class="display-section">
            <h2>Your Friends</h2>
            <div class="search-container">
                <input type="text" id="searchBar" placeholder="Search friends...">
            </div>

            <div class="sort-controls-container">
                <label for="sortSelect"><i class="fas fa-sort"></i> Sort By:</label>
                <select id="sortSelect">
                    <option value="name-asc">Name (A-Z)</option>
                    <option value="name-desc">Name (Z-A)</option>
                    <option value="truthness-desc">Truthfulness (High to Low)</option>
                    <option value="truthness-asc">Truthfulness (Low to High)</option>
                    <option value="angriness-desc">Angriness (High to Low)</option>
                    <option value="angriness-asc">Angriness (Low to High)</option>
                    <option value="humor-desc">Humor (High to Low)</option>
                    <option value="humor-asc">Humor (Low to High)</option>
                    <option value="empathy-desc">Empathy (High to Low)</option>
                    <option value="empathy-asc">Empathy (Low to High)</option>
                    <option value="optimism-desc">Optimism (High to Low)</option>
                    <option value="optimism-asc">Optimism (Low to High)</option>
                    <option value="creativity-desc">Creativity (High to Low)</option>
                    <option value="creativity-asc">Creativity (Low to High)</option>
                    <option value="socialScore-desc">Social Score (High to Low)</option>
                    <option value="socialScore-asc">Social Score (Low to High)</option>
                    <option value="calmness-desc">Calmness (High to Low)</option>
                    <option value="calmness-asc">Calmness (Low to High)</option>
                    <option value="punctuality-desc">Punctuality (High to Low)</option>
                    <option value="punctuality-asc">Punctuality (Low to High)</option>
                </select>
            </div>

            <div class="comparison-controls-container">
                <div class="comparison-dropdowns">
                    <select id="friend1Select">
                        <option value="">Select Friend 1</option>
                    </select>
                    <select id="friend2Select">
                        <option value="">Select Friend 2</option>
                    </select>
                </div>
                <button id="compareFriendsBtn"><i class="fas fa-exchange-alt"></i> Compare Friends</button>
            </div>

            <div id="comparisonResult" style="display: none;">
                <h3>Friend Comparison</h3>
                <div id="comparisonTableContainer">
                    </div>
            </div>

            <div class="filter-controls-container">
                <button id="filterButton"><i class="fas fa-filter"></i> Filter Friends</button>
                <div id="filterPanel" class="filter-dropdown-menu">
                    <div class="filter-section">
                        <h4>Parameter Ranges (0-10)</h4>
                        <div class="filter-param-group">
                            <label for="truthnessMin">Truthfulness:</label>
                            <input type="number" id="truthnessMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="truthnessMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="angrinessMin">Angriness:</label>
                            <input type="number" id="angrinessMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="angrinessMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="humorMin">Humor:</label>
                            <input type="number" id="humorMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="humorMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="empathyMin">Empathy:</label>
                            <input type="number" id="empathyMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="empathyMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="optimismMin">Optimism:</label>
                            <input type="number" id="optimismMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="optimismMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="creativityMin">Creativity:</label>
                            <input type="number" id="creativityMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="creativityMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="socialScoreMin">Social Score:</label>
                            <input type="number" id="socialScoreMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="socialScoreMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="calmnessMin">Calmness:</label>
                            <input type="number" id="calmnessMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="calmnessMax" min="0" max="10" placeholder="Max">
                        </div>
                        <div class="filter-param-group">
                            <label for="punctualityMin">Punctuality:</label>
                            <input type="number" id="punctualityMin" min="0" max="10" placeholder="Min">
                            <input type="number" id="punctualityMax" min="0" max="10" placeholder="Max">
                        </div>
                    </div>
                    <div class="filter-section">
                        <h4>Keywords</h4>
                        <div class="filter-param-group">
                            <label for="foodPreferenceFilter">Food Preference:</label>
                            <input type="text" id="foodPreferenceFilter" placeholder="e.g., pizza, vegan">
                        </div>
                        <div class="filter-param-group">
                            <label for="hobbiesFilter">Hobbies:</label>
                            <input type="text" id="hobbiesFilter" placeholder="e.g., hiking, reading">
                        </div>
                        <div class="filter-param-group">
                            <label for="notesFilter">Notes:</label>
                            <input type="text" id="notesFilter" placeholder="e.g., colleague, birthday">
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button id="applyFiltersBtn" class="filter-action-btn"><i class="fas fa-check-circle"></i> Apply Filters</button>
                        <button id="clearFiltersBtn" class="filter-action-btn clear-btn"><i class="fas fa-times-circle"></i> Clear Filters</button>
                    </div>
                </div>
            </div>

            <div class="data-management-buttons">
                <button id="exportData"><i class="fas fa-download"></i> Export Data (JSON)</button>
                <input type="file" id="importFileInput" accept=".json">
                <button id="importDataButton"><i class="fas fa-upload"></i> Import Data (JSON)</button>
            </div>

            <div id="friendsList" class="friends-grid">
                <p id="noFriendsMessage">No friends added yet. Go to 'Add Friend' to get started!</p>
            </div>
        </div>
    </div>

    <script>
        function getFriends() {
            const friendsJSON = localStorage.getItem('friends');
            return friendsJSON ? JSON.parse(friendsJSON) : [];
        }

        function saveFriends(friends) {
            localStorage.setItem('friends', JSON.stringify(friends));
        }

        function deleteFriend(nameToDelete) {
            if (confirm(`Are you sure you want to delete ${nameToDelete}? This action cannot be undone.`)) {
                let friends = getFriends();
                friends = friends.filter(friend => friend.name !== nameToDelete);
                saveFriends(friends);
                renderFriendsList(); // Re-render the list after deletion
                populateFriendSelects(); // Re-populate comparison dropdowns
                alert(`${nameToDelete} has been deleted.`);
            }
        }

        function createFriendCard(friend) {
            const card = document.createElement('div');
            card.classList.add('friend-card');
            card.dataset.name = friend.name; // Store name for easy reference

            // Click card to edit
            card.addEventListener('click', function(event) {
                // Ensure we don't trigger edit if delete button was clicked
                if (!event.target.classList.contains('delete-card-button') && !event.target.closest('.delete-card-button')) {
                    window.location.href = `index.html?edit=${encodeURIComponent(friend.name)}`;
                }
            });

            card.innerHTML = `
                <h3>${friend.name}</h3>
                <button class="delete-card-button" title="Delete Friend"><i class="fas fa-trash-alt"></i></button>
                <p><strong>Truthfulness:</strong> ${friend.truthness}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.truthness)}" style="width: ${friend.truthness * 10}%;"></div></div>
                <p><strong>Angriness:</strong> ${friend.angriness}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.angriness)}" style="width: ${friend.angriness * 10}%;"></div></div>
                <p><strong>Humor:</strong> ${friend.humor}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.humor)}" style="width: ${friend.humor * 10}%;"></div></div>
                <p><strong>Empathy:</strong> ${friend.empathy}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.empathy)}" style="width: ${friend.empathy * 10}%;"></div></div>
                <p><strong>Optimism:</strong> ${friend.optimism}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.optimism)}" style="width: ${friend.optimism * 10}%;"></div></div>
                <p><strong>Creativity:</strong> ${friend.creativity}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.creativity)}" style="width: ${friend.creativity * 10}%;"></div></div>
                <p><strong>Social Score:</strong> ${friend.socialScore}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.socialScore)}" style="width: ${friend.socialScore * 10}%;"></div></div>
                <p><strong>Calmness:</strong> ${friend.calmness}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.calmness)}" style="width: ${friend.calmness * 10}%;"></div></div>
                <p><strong>Punctuality:</strong> ${friend.punctuality}/10</p>
                <div class="progress-container"><div class="progress-bar ${getProgressBarClass(friend.punctuality)}" style="width: ${friend.punctuality * 10}%;"></div></div>
                <p class="text-param"><strong>Food:</strong> ${friend.foodPreference || 'N/A'}</p>
                <p class="text-param"><strong>Hobbies:</strong> ${friend.hobbies || 'N/A'}</p>
                <p class="text-param"><strong>Notes:</strong> ${friend.notes || 'N/A'}</p>
            `;

            // Attach event listener to the delete button within the card
            const deleteBtn = card.querySelector('.delete-card-button');
            deleteBtn.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent card click event from firing
                deleteFriend(friend.name);
            });

            return card;
        }

        function getProgressBarClass(value) {
            if (value <= 3) {
                return 'low';
            } else if (value <= 7) {
                return 'medium';
            } else {
                return 'high';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Elements ---
            const friendsListContainer = document.getElementById('friendsList');
            const noFriendsMessage = document.getElementById('noFriendsMessage');
            const searchBar = document.getElementById('searchBar');
            const exportDataBtn = document.getElementById('exportData');
            const importFileInput = document.getElementById('importFileInput');
            const importDataButton = document.getElementById('importDataButton');

            // --- Filter Elements ---
            const filterButton = document.getElementById('filterButton');
            const filterPanel = document.getElementById('filterPanel');
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');

            const numericalParams = ['truthness', 'angriness', 'humor', 'empathy', 'optimism', 'creativity', 'socialScore', 'calmness', 'punctuality'];
            const textParams = ['foodPreference', 'hobbies', 'notes'];

            const filterInputs = {};
            numericalParams.forEach(param => {
                filterInputs[`${param}Min`] = document.getElementById(`${param}Min`);
                filterInputs[`${param}Max`] = document.getElementById(`${param}Max`);
            });
            textParams.forEach(param => {
                filterInputs[`${param}Filter`] = document.getElementById(`${param}Filter`);
            });

            // --- Sorting Elements ---
            const sortSelect = document.getElementById('sortSelect');

            // --- Comparison Elements ---
            const friend1Select = document.getElementById('friend1Select');
            const friend2Select = document.getElementById('friend2Select');
            const compareFriendsBtn = document.getElementById('compareFriendsBtn');
            const comparisonResultDiv = document.getElementById('comparisonResult');
            const comparisonTableContainer = document.getElementById('comparisonTableContainer');

            // --- Filter Panel Toggle Logic ---
            filterButton.addEventListener('click', function(event) {
                event.stopPropagation(); // Prevent document click from immediately closing it
                filterPanel.classList.toggle('visible');
            });

            // Close panel if clicked outside
            document.addEventListener('click', function(event) {
                if (!filterPanel.contains(event.target) && !filterButton.contains(event.target)) {
                    filterPanel.classList.remove('visible');
                }
            });

            // --- Filter, Search, and Sort Logic for Render ---
            function renderFriendsList() {
                const allFriends = getFriends(); // Get all friends
                const searchTerm = searchBar.value.toLowerCase();
                const sortBy = sortSelect.value; // Get current sort selection
                let [sortKey, sortOrder] = sortBy.split('-'); // e.g., "name-asc" -> ["name", "asc"]

                friendsListContainer.innerHTML = ''; // Clear existing cards

                if (allFriends.length === 0) {
                    noFriendsMessage.style.display = 'block';
                    return;
                } else {
                    noFriendsMessage.style.display = 'none';
                }

                let filteredAndSearchedFriends = allFriends.filter(friend => {
                    // 1. Apply Search Filter
                    const matchesSearch = 
                        friend.name.toLowerCase().includes(searchTerm) ||
                        (friend.notes && friend.notes.toLowerCase().includes(searchTerm)) ||
                        (friend.foodPreference && friend.foodPreference.toLowerCase().includes(searchTerm)) ||
                        (friend.hobbies && friend.hobbies.toLowerCase().includes(searchTerm));

                    if (!matchesSearch) return false; // If doesn't match search, exclude immediately

                    // 2. Apply Numerical Parameter Filters
                    for (const param of numericalParams) {
                        const minVal = parseFloat(filterInputs[`${param}Min`].value);
                        const maxVal = parseFloat(filterInputs[`${param}Max`].value);
                        // Use a default of 0 if parameter is missing, or ensure it's a number
                        const friendValue = parseFloat(friend[param] || 0); 

                        if (!isNaN(minVal) && friendValue < minVal) {
                            return false;
                        }
                        if (!isNaN(maxVal) && friendValue > maxVal) {
                            return false;
                        }
                    }

                    // 3. Apply Text Parameter Filters
                    for (const param of textParams) {
                        const filterText = filterInputs[`${param}Filter`].value.toLowerCase().trim();
                        const friendText = friend[param] ? String(friend[param]).toLowerCase() : ''; 

                        if (filterText && !friendText.includes(filterText)) {
                            return false;
                        }
                    }

                    return true; // Friend matches all search and filter criteria
                });

                // 4. Apply Sorting
                filteredAndSearchedFriends.sort((a, b) => {
                    let valA, valB;

                    if (sortKey === 'name') {
                        valA = a.name.toLowerCase();
                        valB = b.name.toLowerCase();
                        if (sortOrder === 'asc') {
                            return valA.localeCompare(valB);
                        } else {
                            return valB.localeCompare(valA);
                        }
                    } else { // Numerical parameters
                        // Use 0 if the parameter is undefined/null for consistent sorting
                        valA = parseFloat(a[sortKey] || 0); 
                        valB = parseFloat(b[sortKey] || 0);

                        if (sortOrder === 'asc') {
                            return valA - valB;
                        } else {
                            return valB - valA;
                        }
                    }
                });


                if (filteredAndSearchedFriends.length === 0) {
                    friendsListContainer.innerHTML = `<p style="text-align: center; color: #999;">No friends found matching your search and filter criteria.</p>`;
                    return;
                }

                filteredAndSearchedFriends.forEach(friend => {
                    friendsListContainer.appendChild(createFriendCard(friend));
                });
            }

            // --- Comparison Tool Logic ---
            function populateFriendSelects() {
                const friends = getFriends();
                friend1Select.innerHTML = '<option value="">Select Friend 1</option>';
                friend2Select.innerHTML = '<option value="">Select Friend 2</option>';

                friends.forEach(friend => {
                    const option1 = document.createElement('option');
                    option1.value = friend.name;
                    option1.textContent = friend.name;
                    friend1Select.appendChild(option1);

                    const option2 = document.createElement('option');
                    option2.value = friend.name;
                    option2.textContent = friend.name;
                    friend2Select.appendChild(option2);
                });

                // Clear any previous comparison results and hide the section
                comparisonResultDiv.style.display = 'none';
            }

            function displayComparison(friend1, friend2) {
                if (!friend1 || !friend2) {
                    alert("Please select two different friends to compare.");
                    return;
                }

                if (friend1.name === friend2.name) {
                    alert("Please select two *different* friends to compare.");
                    return;
                }

                let html = `<table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>${friend1.name}</th>
                                        <th>${friend2.name}</th>
                                    </tr>
                                </thead>
                                <tbody>`;

                const allParams = [
                    { key: 'truthness', label: 'Truthfulness', type: 'numerical' },
                    { key: 'angriness', label: 'Angriness', type: 'numerical' },
                    { key: 'humor', label: 'Humor', type: 'numerical' },
                    { key: 'empathy', label: 'Empathy', type: 'numerical' },
                    { key: 'optimism', label: 'Optimism', type: 'numerical' },
                    { key: 'creativity', label: 'Creativity', type: 'numerical' },
                    { key: 'socialScore', label: 'Social Score', type: 'numerical' },
                    { key: 'calmness', label: 'Calmness', type: 'numerical' },
                    { key: 'punctuality', label: 'Punctuality', type: 'numerical' },
                    { key: 'foodPreference', label: 'Food Preference', type: 'text' },
                    { key: 'hobbies', label: 'Hobbies', type: 'text' },
                    { key: 'notes', label: 'Notes', type: 'text' }
                ];

                allParams.forEach(param => {
                    const val1 = friend1[param.key] !== undefined ? friend1[param.key] : 'N/A';
                    const val2 = friend2[param.key] !== undefined ? friend2[param.key] : 'N/A';

                    html += `<tr>
                                <td class="param-label">${param.label}:</td>`;
                    
                    if (param.type === 'numerical') {
                        html += `<td class="friend-value-column">
                                    ${val1}/10
                                    <div class="progress-container"><div class="progress-bar ${getProgressBarClass(val1)}" style="width: ${val1 * 10}%;"></div></div>
                                </td>
                                <td class="friend-value-column">
                                    ${val2}/10
                                    <div class="progress-container"><div class="progress-bar ${getProgressBarClass(val2)}" style="width: ${val2 * 10}%;"></div></div>
                                </td>`;
                    } else { // Text parameters
                        html += `<td class="friend-value-column text-param-value">${val1 || 'N/A'}</td>
                                <td class="friend-value-column text-param-value">${val2 || 'N/A'}</td>`;
                    }
                    html += `</tr>`;
                });

                html += `</tbody></table>`;
                comparisonTableContainer.innerHTML = html;
                comparisonResultDiv.style.display = 'block'; // Show the comparison section
            }

            // Event Listener for Compare Button
            compareFriendsBtn.addEventListener('click', function() {
                const friends = getFriends();
                const selectedName1 = friend1Select.value;
                const selectedName2 = friend2Select.value;

                const friend1 = friends.find(f => f.name === selectedName1);
                const friend2 = friends.find(f => f.name === selectedName2);

                displayComparison(friend1, friend2);
            });


            // Initial render
            renderFriendsList();
            populateFriendSelects(); // Populate dropdowns when page loads

            // Event Listeners for Search, Filter, and Sort
            searchBar.addEventListener('input', renderFriendsList);
            sortSelect.addEventListener('change', renderFriendsList); // Added listener for sort dropdown

            applyFiltersBtn.addEventListener('click', function() {
                renderFriendsList(); // Re-render with current filter settings
                filterPanel.classList.remove('visible'); // Hide panel after applying
            });

            // Clear Filters
            clearFiltersBtn.addEventListener('click', function() {
                // Reset all numerical inputs
                numericalParams.forEach(param => {
                    filterInputs[`${param}Min`].value = '';
                    filterInputs[`${param}Max`].value = '';
                });
                // Reset all text inputs
                textParams.forEach(param => {
                    filterInputs[`${param}Filter`].value = '';
                });
                renderFriendsList(); // Re-render with cleared filters
                filterPanel.classList.remove('visible'); // Hide panel after clearing
            });

            // --- Export Data Feature ---
            exportDataBtn.addEventListener('click', function() {
                const friends = getFriends();
                if (friends.length === 0) {
                    alert("No friend data to export!");
                    return;
                }

                const dataStr = JSON.stringify(friends, null, 2); // null, 2 for pretty printing
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'friendforge_data.json';
                document.body.appendChild(a); // Append to body is good practice
                a.click();
                document.body.removeChild(a); // Clean up
                URL.revokeObjectURL(url); // Release the URL object
                alert('FriendForge data exported successfully!');
            });

            // --- Import Data Feature ---
            // Trigger file input click when import button is clicked
            importDataButton.addEventListener('click', function() {
                importFileInput.click();
            });

            importFileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) {
                    return; // No file selected
                }

                if (file.type !== "application/json") {
                    alert("Please select a valid JSON file (.json).");
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedFriends = JSON.parse(e.target.result);

                        // Basic validation: Check if it's an array and contains objects that look like friends
                        if (!Array.isArray(importedFriends)) {
                            throw new Error("Invalid data format: Expected an array.");
                        }
                        if (importedFriends.length > 0 && typeof importedFriends[0] !== 'object' || !importedFriends[0].name) {
                            throw new Error("Invalid data format: Array elements do not look like friend objects.");
                        }

                        // Optional: Ask user if they want to merge or overwrite
                        const overwrite = confirm("Do you want to REPLACE your current friend data with the imported data? (Click Cancel to MERGE data)");
                        
                        let finalFriends = [];
                        if (overwrite) {
                            finalFriends = importedFriends;
                            alert("FriendForge data replaced successfully!");
                        } else {
                            let currentFriends = getFriends();
                            // Simple merge: add new friends, update existing by name
                            importedFriends.forEach(importedFriend => {
                                const existingIndex = currentFriends.findIndex(f => f.name.toLowerCase() === importedFriend.name.toLowerCase());
                                if (existingIndex > -1) {
                                    currentFriends[existingIndex] = importedFriend; // Update existing
                                } else {
                                    currentFriends.push(importedFriend); // Add new
                                }
                            });
                            finalFriends = currentFriends;
                            alert("FriendForge data merged successfully!");
                        }
                        
                        saveFriends(finalFriends);
                        renderFriendsList(); // Re-render the list with new data
                        populateFriendSelects(); // Re-populate comparison dropdowns after import
                        
                    } catch (error) {
                        console.error("Error importing data:", error);
                        alert(`Failed to import data: ${error.message || "Invalid JSON file or data format."}\nPlease ensure the file is a valid FriendForge export.`);
                    } finally {
                        // Clear the file input so the same file can be selected again if needed
                        event.target.value = '';
                    }
                };
                reader.readAsText(file);
            });
        });
    </script>
</body>
</html>
